<div class="tabs-collections-swiper" id="tabs-collections-swiper-{{ section.id }}">

  <div class="wrapper-text-section">
    <h3>{{ section.settings.heading | upcase }}</h3>
    <p>{{ section.settings.subheading }}</p>
  </div>

  <!-- Botones -->
  <div class="tabs-buttons">
    {% for block in section.blocks %}
      {% assign coll = collections[block.settings.collection] %}
        <button
        class="tab-button{% if forloop.first %} active{% endif %}"
        data-collection="{{ coll.handle }}"
        data-url="{{ coll.url }}"
        type="button">

        <!-- SVG decorativo (visible solo cuando el botón está activo) -->
        <span class="tab-button-bg">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="51"
            height="45"
            viewBox="0 0 51 45"
            fill="none">
            <g style="mix-blend-mode:multiply" opacity="0.55">
              <path d="M0 44.2478L16.1796 23.4451L1.32049 -8.42356e-05L16.1796 -8.48851e-05L30.7086 22.1239L14.1989 44.2478L0 44.2478Z" fill="#E23332" />
            </g>
            <g style="mix-blend-mode:multiply" opacity="0.55">
              <path d="M19.8252 44.2478L36.0048 23.4451L21.1457 -8.42356e-05L36.0048 -8.48851e-05L50.5338 22.1239L34.024 44.2478L19.8252 44.2478Z" fill="#E23332" />
            </g>
          </svg>
        </span>

        <h5 class="tab-button-label">{{ coll.title | upcase }}</h5>
      </button>
    {% endfor %}
  </div>

  <!-- Carruseles -->
  <div class="tabs-swiper-container">
    {% for block in section.blocks %}
      {% assign coll = collections[block.settings.collection] %}
      <div class="tab-panel{% unless forloop.first %} hidden{% endunless %}" data-collection="{{ coll.handle }}">
        <div class="swiper mySwiper-{{ section.id }}">
          <div class="swiper-wrapper">
            {% for product in coll.products limit: section.settings.max_products %}
              <div class="swiper-slide">
                <div class="product-card">
                  {% if product.tags contains 'bestseller' %}
                    <span class="bestseller-label" style="position:absolute;top:12px;left:12px;display:inline-block;background:#e23332;color:white;padding:4px 12px;border-radius:4px;font-size:13px;font-weight:bold;margin-bottom:8px;z-index:2;">BESTSELLER</span>
                  {% endif %}
                  {% if product.featured_image %}
                    <a href="{{ product.url }}">
                      <img src="{{ product.featured_image | img_url: 'master' }}" alt="{{ product.title }}">
                    </a>
                  {% endif %}
                  <div>
                    <a style="color: black;" href="{{ product.url }}">
                      <h3>{{ product.title }}</h3>
                      <div class="wrapper-product-info">
                        {% if product.metafields.custom.peso != blank %}
                          <h5 class="peso">{{ product.metafields.custom.peso }}</h5>
                        {% endif %}
                        {% if product.metafields.custom.short_description.value != blank %}
                          <h5 class="short-description">{{ product.metafields.custom.short_description.value }}</h5>
                        {% endif %}
                        <p class="price-tabs">
                          {% if product.compare_at_price > product.price %}
                            <span>
                              {{ product.price | money_with_currency }}
                            </span>
                            <span style="text-decoration:line-through;color:#ff0000;">
                              {{ product.compare_at_price | money_with_currency }}
                            </span>
                          {% else %}
                            {{ product.price | money_with_currency }}
                          {% endif %}
                        </p>
                      </div>
                    </a>
                    <form method="post" action="/cart/add">
                      <input
                        type="hidden"
                        name="id"
                        value="{{ product.variants.first.id }}">
                      <button type="submit" class="add-to-cart-btn-card">
                        + Agregar al carrito
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

  <!-- Ver todo -->
  <div class="view-all-wrapper">
    {% assign first_block = section.blocks[0] %}
    {% assign first_coll = collections[first_block.settings.collection] %}
    <a
      id="viewAllBtn-{{ section.id }}"
      href="{{ first_coll.url }}"
      class="view-all-button">VER TODO</a>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const container = document.getElementById('tabs-collections-swiper-{{ section.id }}');
    if (!container) return;
  
    const swiperEls = container.querySelectorAll('.mySwiper-{{ section.id }}');
    swiperEls.forEach(swiperEl => {
      new Swiper(swiperEl, {
        slidesPerView: 1.3,
        spaceBetween: 16,
        freeMode: true,
        breakpoints: {
          768: {
            slidesPerView: 4,
          }
        }
      });
    });
  
    const buttons = container.querySelectorAll('.tab-button');
    const panels = container.querySelectorAll('.tab-panel');
    const viewAllBtn = container.querySelector('#viewAllBtn-{{ section.id }}');
  
    buttons.forEach(btn => {
      btn.addEventListener('click', function () {
        const target = this.dataset.collection;
        const url = this.dataset.url;
  
        buttons.forEach(b => b.classList.remove('active'));
        this.classList.add('active');
  
        panels.forEach(p => {
          if (p.dataset.collection === target) {
            p.classList.remove('hidden');
          } else {
            p.classList.add('hidden');
          }
        });
  
        viewAllBtn.setAttribute('href', url);
      });
    });
  });
</script>

<style>
  .tab-button {
    position: relative;
    overflow: hidden;
    display: flex;
    align-items: center;
    gap: 10px;
    flex: 0 0 auto;
    padding: 12px 32px;
    border: 2px solid #ffffff;
    background-color: white;
    color: black;
    font-weight: bold;
    text-transform: uppercase;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
    font-size: 16px;
  }

  .wrapper-text-section {
    text-align: center;
  }

  .tab-button.active {
    background-color: #a31e1e;
    color: white;
    border-color: #a31e1e;
  }

  h5.tab-button-label {
    margin: 0;
  }

  .tab-button-bg {
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    height: 100%;
    display: none;
    align-items: center;
    z-index: 0;
  }

  .tab-button.active .tab-button-bg {
    display: flex;
  }

  .tab-button-bg svg {
    height: 100%;
    width: auto;
  }

  .tab-button-label {
    position: relative;
    z-index: 1;
    font-family: 'HelveticaCondensedmMedium'
    , sans-serif;
    font-size: 18px;
    padding-left: 10px;
  }


  .add-to-cart-btn-card {
    background: #e23332;
    color: white;
    padding: 10px 24px;
    border: none;
    border-radius: 4px;
    font-family: 'HelveticaCondensedmMedium';
    cursor: pointer;
    font-size: 18px;
    width: 100%;
  }
  /* Resto de estilos (sin cambios) */
  .tab-panel.hidden {
    display: none;
  }
  .product-card {
    position: relative;
    background: white;
    padding: 12px;
    border-radius: 6px;
    text-align: left;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
  }
  .product-card img {
    width: 100%;
    margin-bottom: 8px;
    object-fit: cover;
    aspect-ratio: 1 / 1;
  }
  .product-card h3 {
    font-size: 1.3rem;
    font-weight: bold;
    margin: 24px 0 0;
    color: black;
    text-align: left;
  }
  .wrapper-product-info {
    display: flex;
    gap: 14px;
    flex-direction: column;
    padding: 12px 0;
  }
  .wrapper-product-info p {
    margin: 0;
    font-family: 'HelveticaCondensed';
  }
  h5.peso {
    margin: 0;
    font-size: 14px;
    font-weight: lighter;
    color: #626060;
    font-family: 'HelveticaNeue'
    , sans-serif;
  }
  h5.short-description {
    font-family: 'HelveticaCondensedmMedium', sans-serif !important;
    font-size: 1rem;
    margin: 0;
  }
  p.price-tabs {
    font-size: 16px;
    font-family: 'HelveticaNeue'
    , sans-serif;
    font-weight: 800;
  }
  .tabs-buttons {
    display: flex;
    gap: 12px;
    padding: 24px 24px 8px;
    margin-bottom: 16px;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
  }
  .tabs-swiper-container {
    padding: 24px;
  }
  .tabs-collections-swiper {
    padding: 54px 0;
    max-width: 1500px;
    margin: 0 auto;
  }
  .view-all-wrapper {
    text-align: center;
    margin-top: 1.5rem;
  }
  .view-all-button {
    display: inline-block;
    padding: 12px 64px;
    background: #e23332;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    font-size: 18px;
    transition: background 0.3s ease;
    font-family: 'HelveticaCondensedmMedium'
  }
  .view-all-button:hover {
    background: #c62c2b;
  }
</style>

{% schema %}
  {
    "name": "tabs collection",
    "settings": [
      {
        "type": "text",
        "id": "heading",
        "label": "Título"
      }, {
        "type": "text",
        "id": "subheading",
        "label": "Subtítulo"
      }, {
        "type": "range",
        "id": "max_products",
        "step": 1,
        "label": "Máximo de productos",
        "min": 1,
        "max": 20,
        "default": 8
      }
    ],
    "blocks": [
      {
        "type": "tab",
        "name": "Colección (pestaña)",
        "settings": [
          {
            "type": "collection",
            "id": "collection",
            "label": "Colección"
          },
          {
            "type": "text",
            "id": "title-text",
            "label": "text"
          },
        ]
      }
    ],
    "max_blocks": 5,
    "presets": [
      {
        "name": "Tabs de Colección",
        "category": "Productos"
      }
    ]
  }
{% endschema %}