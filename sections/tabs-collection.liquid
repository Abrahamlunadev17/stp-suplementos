<div class="tabs-collections-swiper">

  <div class="wrapper-text-section">
    <h3>{{ section.settings.heading }}</h3>
    <p>{{ section.settings.subheading }}</p>
  </div>

  <!-- Botones -->
  <div class="tabs-buttons">
    {% for block in section.blocks %}
      {% assign coll = collections[block.settings.collection] %}
      <button
        class="tab-button{% if forloop.first %} active{% endif %}"
        data-collection="{{ coll.handle }}"
        data-url="{{ coll.url }}"
        type="button">
        <span class="tab-button-label">{{ coll.title }}</span>
      </button>
    {% endfor %}
  </div>

  <!-- Carruseles -->
  <div class="tabs-swiper-container">
    {% for block in section.blocks %}
      {% assign coll = collections[block.settings.collection] %}
      <div class="tab-panel{% unless forloop.first %} hidden{% endunless %}" data-collection="{{ coll.handle }}">
        <div class="swiper mySwiper">
          <div class="swiper-wrapper">
            {% for product in coll.products limit: section.settings.max_products %}
              <div class="swiper-slide">
                <div class="product-card">
                  {% if product.featured_image %}
                    <a href="{{ product.url }}">
                      <img src="{{ product.featured_image | img_url: 'master' }}" alt="{{ product.title }}">
                    </a>
                  {% endif %}
                  <h3>{{ product.title }}</h3>
                  <p>{{ product.price | money }}</p>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

  <!-- Ver todo -->
  <div class="view-all-wrapper">
    {% assign first_block = section.blocks[0] %}
    {% assign first_coll = collections[first_block.settings.collection] %}
    <a id="viewAllBtn" href="{{ first_coll.url }}" class="view-all-button">VER TODO</a>
  </div>
</div>

<style>
  .wrapper-text-section {
    text-align: center;
  }
  .wrapper-text-section p,
  .wrapper-text-section h2 {
    margin: 0;
  }

  .tabs-collections-swiper {
    padding: 32px 0;
    max-width: 1500px;
    margin: 0 auto;
  }

  .tabs-swiper-container {
    padding: 24px;
  }

  .tabs-buttons {
    display: flex;
    gap: 12px;
    padding: 24px 24px 8px;
    margin-bottom: 16px;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
  }

  .tab-button {
    display: flex;
    align-items: center;
    gap: 10px;
    flex: 0 0 auto;
    padding: 16px 18px;
    border: 2px solid #ffffff;
    background-color: white;
    color: black;
    font-weight: bold;
    text-transform: uppercase;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
  }

  .tab-button-icon {
    display: flex;
    align-items: center;
  }

  .tab-button.active {
    background-color: #e23332;
    color: white;
    border-color: #e23332;
  }

  .tab-panel.hidden {
    display: none;
  }

  .product-card {
    background: white;
    padding: 12px;
    color: black;
    border-radius: 6px;
    text-align: left;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
  }
  .product-card img {
    width: 100%;
    height: auto;
    margin-bottom: 8px;
  }
  .product-card h3 {
    font-size: 1rem;
    font-weight: bold;
    margin: 0.5rem 0;
    color: black;
  }
  .product-card p {
    font-size: 1rem;
    color: #333;
  }

  .view-all-wrapper {
    text-align: center;
    margin-top: 1.5rem;
  }
  .view-all-button {
    display: inline-block;
    padding: 12px 24px;
    background: #e23332;
    color: white;
    text-align: center;
    text-decoration: none;
    font-weight: bold;
    border-radius: 4px;
    transition: background 0.3s ease;
  }
  .view-all-button:hover {
    background: #c62c2b;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Init Swiper
    const swipers = document.querySelectorAll('.mySwiper');
    swipers.forEach(swiperEl => {
      new Swiper(swiperEl, {
        slidesPerView: 1.3,
        spaceBetween: 16,
        freeMode: true,
        breakpoints: {
          768: {
            slidesPerView: 4,
          }
        }
      });
    });

    // Tabs
    const buttons = document.querySelectorAll('.tab-button');
    const panels = document.querySelectorAll('.tab-panel');
    const viewAllBtn = document.getElementById('viewAllBtn');

    function updateButtonIcons() {
      buttons.forEach(btn => {
        btn.querySelector('.tab-button-icon')?.remove();
        if (btn.classList.contains('active')) {
          const svgHTML = `
            <span class="tab-button-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="40" height="24" viewBox="0 0 69 45" fill="none">
                <g style="mix-blend-mode:multiply" opacity="0.55">
                  <path d="M0 44.2479L21.8136 23.4452L1.7803 3.78347e-05L21.8136 3.71852e-05L41.4017 22.124L19.1431 44.2479L0 44.2479Z" fill="#E23332"/>
                </g>
                <g style="mix-blend-mode:multiply" opacity="0.55">
                  <path d="M26.7266 44.2479L48.5401 23.4451L28.5069 -2.32005e-05L48.5401 -2.385e-05L68.1283 22.1239L45.8697 44.2479L26.7266 44.2479Z" fill="#E23332"/>
                </g>
              </svg>
            </span>
          `;
          btn.insertAdjacentHTML('afterbegin', svgHTML);
        }
      });
    }

    updateButtonIcons();

    buttons.forEach(btn => {
      btn.addEventListener('click', function () {
        const target = this.dataset.collection;
        const url = this.dataset.url;

        buttons.forEach(b => b.classList.remove('active'));
        this.classList.add('active');

        panels.forEach(p => {
          if (p.dataset.collection === target) {
            p.classList.remove('hidden');
          } else {
            p.classList.add('hidden');
          }
        });

        viewAllBtn.setAttribute('href', url);
        updateButtonIcons();
      });
    });
  });
</script>

{% schema %}
{
  "name": "Tabs Collection Simple",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Título"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subtítulo"
    },
    {
      "type": "range",
      "id": "max_products",
      "label": "Máximo de productos",
      "min": 1,
      "max": 20,
      "default": 8
    }
  ],
  "blocks": [
    {
      "type": "tab",
      "name": "Colección (pestaña)",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Colección"
        }
      ]
    }
  ],
  "max_blocks": 5,
  "presets": [
    {
      "name": "Tabs de Colección",
      "category": "Productos"
    }
  ]
}
{% endschema %}
